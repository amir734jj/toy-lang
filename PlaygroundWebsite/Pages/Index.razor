@page "/"
@using PlaygroundWebsite.Data
@using Models
@inject OnDemandCompilerService _onDemandCompilerService
@inject IJSRuntime _jsRuntime

<h1>Hello, world!</h1>

Welcome to your new app.

<div class="row">
    <div class="col-sm-6">
        <textarea @bind="_code" style="width: 100%; height: 30rem"></textarea>
    </div>
    <div class="col-sm-6">
        <textarea readonly="readonly" style="width: 100%; height: 30rem">@_javascript</textarea>
    </div>
    <div class="col-sm-6">
        <button @onclick="Compile">Compile</button>
        @if (!string.IsNullOrWhiteSpace(_javascript))
        {
            <button @onclick="Run">Run</button>
        }
    </div>
</div>



@code
{
    private string _code;

    private string _javascript;

    async Task Run()
    {
        var result = await _jsRuntime.InvokeAsync<object>("JSMethod", _javascript);
        Console.WriteLine(result);
    }

    void Compile()
    {
        var payload = new CompilerPayload
        {
            Code = _code
        };

        _onDemandCompilerService.Compile(payload);

        _javascript = payload.Result;
    }
}